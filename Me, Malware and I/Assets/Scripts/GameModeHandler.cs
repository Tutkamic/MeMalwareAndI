using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using System.Linq; 

public class GameModeHandler : MonoBehaviour
{
    public static event Action<GameMode> StartMode;
    [SerializeField] GameModeSO currentGameMode;
    [SerializeField] private float changeTourDelayTime;

    private List<EnemyMovement> enemyList;
    private int index = 2;

    void Start()
    {
        currentGameMode.SetGameMode(GameMode.VirusSelection);
        enemyList = FindObjectsOfType<EnemyMovement>().ToList();
    }

    public void CheckIfAllEnemyFinishMoving()
    {
        if (enemyList.Any(enemy => enemy.move)) return;
        StartCoroutine(ChangeTourWithDelay());
    }

    private IEnumerator ChangeTourWithDelay()
    {
        yield return new WaitForSeconds(changeTourDelayTime);
        ChangeTour();
    }

    public void ChangeTour()
    {

        index++;
        if (index > 3) index = 1;
        switch (index)
        {
            case 1:
                currentGameMode.SetGameMode(GameMode.PlayerTour);
                StartMode?.Invoke(GameMode.PlayerTour);
                break;
            case 2:
                currentGameMode.SetGameMode(GameMode.EnemyTour);
                StartMode?.Invoke(GameMode.EnemyTour);
                break;
            case 3:
                currentGameMode.SetGameMode(GameMode.VirusSelection);
                StartMode?.Invoke(GameMode.VirusSelection);
                break;
        }
    }

}
