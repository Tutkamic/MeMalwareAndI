using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using TMPro;
using UnityEngine.UI;

public class CanvasGameStateHandler : MonoBehaviour
{
    [SerializeField] private UnityEngine.UI.Button[] malwareButtons;
    [SerializeField] private TextMeshProUGUI[] malwareButtonsText;
    [SerializeField] private UnityEngine.UI.Button changeTourButton;
    [SerializeField] private TextMeshProUGUI changeTourText;
    [SerializeField] GameModeSO currentGameMode;

    [SerializeField] Color activeMalwareButtonColor;
    [SerializeField] Color normalMalwareButtonColor;

    [SerializeField] Color activeMalwareButtonTextColor;
    [SerializeField] Color normalMalwareButtonTextColor;

    private float alphaColorInactive = 0.1f;
    private float glowActive = 0.15f;

    private bool resetButtons;

    private void Update()
    {
        if (currentGameMode.GameMode == GameMode.VirusSelection) MalwareChooseTour();
        else if (currentGameMode.GameMode == GameMode.PlayerTour) PlayerTour();
        else if (currentGameMode.GameMode == GameMode.EnemyTour) EnemyTour();
    }
    private void Start()
    {
        SetButtonActive(false);
        ChangeTourButtonInactive();
        ButtonActive(1);
    }


    public void ButtonActive(int num)
    {
        for (int i = 0; i < malwareButtons.Length; i++)
        {
            UnselectMalwareButton(i+1);
        }
        SetActiveMalware(num);
    }

    public void SetActiveMalware(int num)
    {
        malwareButtons[num - 1].gameObject.GetComponent<Image>().color = activeMalwareButtonColor;
        malwareButtonsText[num - 1].color = activeMalwareButtonTextColor;
    }

    public void UnselectMalwareButton(int num)
    {
        malwareButtons[num - 1].gameObject.GetComponent<Image>().color = normalMalwareButtonColor;
        malwareButtonsText[num - 1].color = normalMalwareButtonTextColor;
    }

    private void SetButtonActive(bool isActive)
    {
        for (int i = 0; i < malwareButtons.Length; i++)
        {
            malwareButtons[i].interactable = isActive;
            float alphaColor = isActive ? 1f : alphaColorInactive;
            malwareButtonsText[i].color = new Color(malwareButtonsText[i].color.r, malwareButtonsText[i].color.g, malwareButtonsText[i].color.b, alphaColor);

            float glowPower = isActive ? glowActive : 0f;
            var materialtext = malwareButtonsText[i].fontMaterial;
            materialtext.SetFloat("_GlowPower", glowPower);
        }
    }
    public void MalwareChooseTour()
    {
        changeTourText.text = "START";
        SetButtonActive(true);
        ChangeTourButtonActive();
        if (resetButtons)
        {
            ButtonActive(1);
            resetButtons = false;
        }
    }

    public void PlayerTour()
    {
        SetButtonActive(false);
        changeTourText.text = "SKIP";
    }

    public void EnemyTour()
    {
        resetButtons = true;
        ChangeTourButtonInactive();
    }


    private void ChangeTourButtonInactive()
    {
        changeTourButton.interactable = false;
        changeTourText.color = new Color(changeTourText.color.r, changeTourText.color.g, changeTourText.color.b, alphaColorInactive);
        var materialtext = changeTourText.fontMaterial;
        materialtext.SetFloat("_GlowPower", 0f);
    }
    private void ChangeTourButtonActive()
    {
        changeTourButton.interactable = true;
        changeTourText.color = new Color(changeTourText.color.r, changeTourText.color.g, changeTourText.color.b, 1f);
        var materialtext = changeTourText.fontMaterial;
        materialtext.SetFloat("_GlowPower", glowActive);
    }

}
