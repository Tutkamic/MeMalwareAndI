using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using UnityEngine;

public class CharacterMoveRange : MonoBehaviour
{
    PathFinding pathFinding;
    private int currentRange;

    private List<FloorTile> floortiles;

    List<FloorTile> tilesInRange = new List<FloorTile>();

    private void OnEnable()
    {
        MovementCharacter.StopMoving += MoveStop;
        MovementCharacter.StartMoving += MoveStart;
    }
    private void OnDisable()
    {
        MovementCharacter.StopMoving -= MoveStop;
        MovementCharacter.StartMoving -= MoveStart;
    }


    private void Awake()
    {
        pathFinding = FindObjectOfType<PathFinding>();
        floortiles = FindObjectsOfType<FloorTile>().ToList();
    }

    private void Start()
    {
        currentRange = 80;
        MoveStop();
    }

    private void MoveStop()
    {
        if (currentRange < 10) return;
        int x = Mathf.RoundToInt(transform.position.x);
        int z = Mathf.RoundToInt(transform.position.z);
        tilesInRange = pathFinding.TilesInRange(x, z , currentRange);
        foreach (FloorTile tile in tilesInRange) tile.SelectableChange(true);
    }

    private void MoveStart()
    {
        foreach (FloorTile tile in floortiles) tile.SelectableChange(false);
    }

    public void RangeDecrease(int x)
    {
        currentRange -= x;
    }
}
