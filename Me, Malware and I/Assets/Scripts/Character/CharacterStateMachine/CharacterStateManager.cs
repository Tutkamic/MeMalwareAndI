using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class CharacterStateManager : MonoBehaviour
{
    public static event Action VirsuActivated;

    [SerializeField] int[] virusMoveRange;
    [SerializeField] PlayerRangeSO playerRange;
    [SerializeField] GameModeSO currentGameMode;

    CharacterBaseState currentState;
    public CharacterVirus1State virus1State = new CharacterVirus1State();
    public CharacterVirus2State virus2State = new CharacterVirus2State();
    public CharacterVirus3State virus3State = new CharacterVirus3State();

    private void OnEnable()
    {
        GameModeHandler.StartMode += ActivateDefaultVirus;
    }
    private void OnDisable()
    {
        GameModeHandler.StartMode -= ActivateDefaultVirus;
    }
    void Start()
    {
        currentState = virus1State;
        currentState.EnterState(this);
    }


    void Update()
    {
        if (currentGameMode.GameMode == GameMode.VirusSelection) GetKeyboardInput();
        else if (currentGameMode.GameMode == GameMode.PlayerTour) currentState.UpdateState(this);
    }

    private void GetKeyboardInput()
    {
        if (Input.GetKeyDown(KeyCode.Alpha1) && currentState != virus1State) SwitchState(virus1State);
        if (Input.GetKeyDown(KeyCode.Alpha2) && currentState != virus2State) SwitchState(virus2State);
        if (Input.GetKeyDown(KeyCode.Alpha3) && currentState != virus3State) SwitchState(virus3State);
    }

    public void SwitchState(CharacterBaseState state)
    {
        currentState = state;
        state.EnterState(this);
    }

    public void VirusActivate(int virusIndex)
    {
        playerRange.SetRange(virusMoveRange[virusIndex]);
        VirsuActivated?.Invoke();
    }

    public void ActivateDefaultVirus(GameMode mode)
    {
        VirusActivate(0);
    }
}
