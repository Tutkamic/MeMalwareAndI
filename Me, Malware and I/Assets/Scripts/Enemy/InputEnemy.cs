using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class InputEnemy : MonoBehaviour
{
    [SerializeField] Transform targetPosition;
    [SerializeField] private float intervalPatrolTime;
    ICharacterMove characterMove;
    private Vector3 positionStart;
    private Vector3 positionEnd;
    private Vector3 positionTarget;
    private int targetIndex;

    private void OnEnable()
    {
        GameModeHandler.StartEnemyMode += StartEnemyMode;
    }

    private void OnDisable()
    {
        GameModeHandler.StartEnemyMode -= StartEnemyMode;
    }

    private void Awake()
    {
        characterMove = GetComponent<ICharacterMove>();
        positionStart = transform.position;
        positionEnd = targetPosition.position;
    }

    void Start()
    {
        targetIndex = 0;
    }

    private void SetTargetPositionAndMove(int index)
    {
        if (index % 2 == 0 || index == 0)
            positionTarget = positionEnd;
        else
            positionTarget = positionStart;

        int w = (int)positionTarget.x;
        int h = (int)positionTarget.z;
        int x = Mathf.RoundToInt(transform.position.x);
        int z = Mathf.RoundToInt(transform.position.z);
        characterMove.Move(w, h, x, z);
    }

    private void StartEnemyMode()
    {
        SetTargetPositionAndMove(targetIndex);
        targetIndex++;
    }
}
