using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class InputEnemy : MonoBehaviour
{
    [SerializeField] Transform targetPosition;
    [SerializeField] private float intervalPatrolTime;
    [SerializeField] private Transform startPositionRotation;
    [SerializeField] private Transform endPositionRotation;
    EnemyMovement characterMove;
    private Vector3 positionStart;
    private Vector3 positionEnd;
    private Vector3 positionTarget;
    private Vector3 rotationStart;
    private Vector3 rotationEnd;
    private Vector3 rotationTarget;
    private int targetIndex;

    private void Awake()
    {
        characterMove = GetComponent<EnemyMovement>();
        positionStart = transform.position;
        positionEnd = targetPosition.position;
        rotationStart = startPositionRotation.position;
        rotationEnd = endPositionRotation.position;
    }

    void Start()
    {
        targetIndex = 0;
    }

    private void SetTargetPositionAndMove(int index)
    {
        if (index % 2 == 0 || index == 0)
            positionTarget = positionEnd;
        else
            positionTarget = positionStart;

        int w = (int)positionTarget.x;
        int h = (int)positionTarget.z;
        int x = Mathf.RoundToInt(transform.position.x);
        int z = Mathf.RoundToInt(transform.position.z);
        characterMove.Move(w, h, x, z);
    }

    private void SetRotationTargetPosition(int index)
    {
        if (index % 2 == 0 || index == 0)
            rotationTarget = rotationEnd;
        else
            rotationTarget = rotationStart;
    }
    public void StartPatrol()
    {
        SetTargetPositionAndMove(targetIndex);
        targetIndex++;
    }

    private void SetRotation()
    {
        SetRotationTargetPosition(targetIndex);
        Vector3 characterPos = transform.position;
        characterPos.y = 0;
        Vector3 direction = (rotationTarget - characterPos).normalized;
        direction.y = 0;
        characterMove.RotateCharacter(direction);
    }

    private void FixedUpdate()
    {
        if (!characterMove.move) SetRotation();
    }

    public void HandleDoorCollision()
    {
        StartPatrol();
    }

}
